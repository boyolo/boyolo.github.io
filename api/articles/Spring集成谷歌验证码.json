{"title":"Spring集成谷歌验证码","slug":"Spring集成谷歌验证码","date":"2022-08-14T02:18:30.000Z","updated":"2024-04-10T14:20:53.409Z","comments":true,"path":"api/articles/Spring集成谷歌验证码.json","realPath":null,"excerpt":null,"covers":null,"cover":null,"content":"<blockquote>\n<p><strong>添加依赖</strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-comment\">&lt;!-- google kaptcha依赖 --&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>  \t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.github.axet<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>  \t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>kaptcha<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>  \t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>0.0.9<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n</blockquote>\n<blockquote>\n<p><strong>配置类 CaptchaConfig.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.boyolo.server.config;<br><br><span class=\"hljs-keyword\">import</span> com.google.code.kaptcha.impl.DefaultKaptcha;<br><span class=\"hljs-keyword\">import</span> com.google.code.kaptcha.util.Config;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Bean;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Configuration;<br><span class=\"hljs-keyword\">import</span> java.util.Properties;<br><br><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CaptchaConfig</span> </span>&#123;<br><br>  <span class=\"hljs-meta\">@Bean</span><br>  <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> DefaultKaptcha <span class=\"hljs-title\">defaultKaptcha</span><span class=\"hljs-params\">()</span> </span>&#123;<br>    <span class=\"hljs-comment\">//验证码生成器</span><br>    DefaultKaptcha defaultKaptcha = <span class=\"hljs-keyword\">new</span> DefaultKaptcha();<br>    <span class=\"hljs-comment\">//配置</span><br>    Properties properties = <span class=\"hljs-keyword\">new</span> Properties();<br>    <span class=\"hljs-comment\">//是否有边框</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.border&quot;</span>, <span class=\"hljs-string\">&quot;yes&quot;</span>);<br>    <span class=\"hljs-comment\">//设置边框颜色</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.border.color&quot;</span>, <span class=\"hljs-string\">&quot;105,179,90&quot;</span>);<br>    <span class=\"hljs-comment\">//边框粗细度，默认为1</span><br>    <span class=\"hljs-comment\">// properties.setProperty(&quot;kaptcha.border.thickness&quot;,&quot;1&quot;);</span><br>    <span class=\"hljs-comment\">//验证码</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.session.key&quot;</span>, <span class=\"hljs-string\">&quot;code&quot;</span>);<br>    <span class=\"hljs-comment\">//验证码文本字符颜色 默认为黑色</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.textproducer.font.color&quot;</span>, <span class=\"hljs-string\">&quot;blue&quot;</span>);<br>    <span class=\"hljs-comment\">//设置字体样式</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.textproducer.font.names&quot;</span>, <span class=\"hljs-string\">&quot;宋体,楷体,微软雅黑&quot;</span>);<br>    <span class=\"hljs-comment\">//字体大小，默认40</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.textproducer.font.size&quot;</span>, <span class=\"hljs-string\">&quot;30&quot;</span>);<br>    <span class=\"hljs-comment\">//验证码文本字符内容范围 默认为abced2345678gfynmnpwx</span><br>    <span class=\"hljs-comment\">// properties.setProperty(&quot;kaptcha.textproducer.char.string&quot;, &quot;&quot;);</span><br>    <span class=\"hljs-comment\">//字符长度，默认为5</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.textproducer.char.length&quot;</span>, <span class=\"hljs-string\">&quot;4&quot;</span>);<br>    <span class=\"hljs-comment\">//字符间距 默认为2</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.textproducer.char.space&quot;</span>, <span class=\"hljs-string\">&quot;4&quot;</span>);<br>    <span class=\"hljs-comment\">//验证码图片宽度 默认为200</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.image.width&quot;</span>, <span class=\"hljs-string\">&quot;100&quot;</span>);<br>    <span class=\"hljs-comment\">//验证码图片高度 默认为40</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.image.height&quot;</span>, <span class=\"hljs-string\">&quot;40&quot;</span>);<br>    Config config = <span class=\"hljs-keyword\">new</span> Config(properties);<br>    defaultKaptcha.setConfig(config);<br>    <span class=\"hljs-keyword\">return</span> defaultKaptcha;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n</blockquote>\n<blockquote>\n<p><strong>CaptchaController</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.boyolo.server.controller;<br><span class=\"hljs-keyword\">import</span> com.google.code.kaptcha.impl.DefaultKaptcha;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiOperation;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class=\"hljs-keyword\">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class=\"hljs-keyword\">import</span> javax.imageio.ImageIO;<br><span class=\"hljs-keyword\">import</span> javax.servlet.ServletOutputStream;<br><span class=\"hljs-keyword\">import</span> javax.servlet.http.HttpServletRequest;<br><span class=\"hljs-keyword\">import</span> javax.servlet.http.HttpServletResponse;<br><span class=\"hljs-keyword\">import</span> java.awt.image.BufferedImage;<br><span class=\"hljs-keyword\">import</span> java.io.IOException;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> renbo</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-meta\">@RestController</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CaptchaController</span> </span>&#123;<br><br>  <span class=\"hljs-meta\">@Autowired</span><br>  <span class=\"hljs-keyword\">private</span> DefaultKaptcha defaultKaptcha;<br><br>  <span class=\"hljs-meta\">@ApiOperation(value = &quot;验证码&quot;)</span><br>  <span class=\"hljs-meta\">@GetMapping(value = &quot;/captcha&quot;, produces = &quot;image/jpeg&quot;)</span><br>  <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">captcha</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;<br>    <span class=\"hljs-comment\">// 定义response输出类型为image/jpeg类型</span><br>    response.setDateHeader(<span class=\"hljs-string\">&quot;Expires&quot;</span>, <span class=\"hljs-number\">0</span>);<br>    <span class=\"hljs-comment\">// Set standard HTTP/1.1 no-cache headers.</span><br>    response.setHeader(<span class=\"hljs-string\">&quot;Cache-Control&quot;</span>, <span class=\"hljs-string\">&quot;no-store, no-cache, must-revalidate&quot;</span>);<br>    <span class=\"hljs-comment\">// Set IE extended HTTP/1.1 no-cache headers (use addHeader).</span><br>    response.addHeader(<span class=\"hljs-string\">&quot;Cache-Control&quot;</span>, <span class=\"hljs-string\">&quot;post-check=0, pre-check=0&quot;</span>);<br>    <span class=\"hljs-comment\">// Set standard HTTP/1.0 no-cache header.</span><br>    response.setHeader(<span class=\"hljs-string\">&quot;Pragma&quot;</span>, <span class=\"hljs-string\">&quot;no-cache&quot;</span>);<br>    <span class=\"hljs-comment\">// return a jpeg</span><br>    response.setContentType(<span class=\"hljs-string\">&quot;image/jpeg&quot;</span>);<br>    <span class=\"hljs-comment\">//-------------------生成验证码 begin ------------------------</span><br>    <span class=\"hljs-comment\">//获取验证码文本内容</span><br>    String text = defaultKaptcha.createText();<br>    System.out.println(<span class=\"hljs-string\">&quot;验证码内容：&quot;</span> + text);<br>    <span class=\"hljs-comment\">//将验证码放入session中</span><br>    request.getSession().setAttribute(<span class=\"hljs-string\">&quot;captcha&quot;</span>, text);<br>    <span class=\"hljs-comment\">//根据文本内容创建图形验证码</span><br>    BufferedImage image = defaultKaptcha.createImage(text);<br>    ServletOutputStream outputStream = <span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span> &#123;<br>      outputStream = response.getOutputStream();<br>      <span class=\"hljs-comment\">//输出流输出图片，格式jpg</span><br>      ImageIO.write(image, <span class=\"hljs-string\">&quot;jpg&quot;</span>, outputStream);<br>      outputStream.flush();<br>    &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>      e.printStackTrace();<br>    &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>      <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != outputStream) &#123;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>          outputStream.close();<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>          e.printStackTrace();<br>        &#125;<br>      &#125;<br>    &#125;<br>    <span class=\"hljs-comment\">//-------------------生成验证码 end --------------------------</span><br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n</blockquote>\n","more":"<blockquote>\n<p><strong>添加依赖</strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-comment\">&lt;!-- google kaptcha依赖 --&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>  \t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.github.axet<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>  \t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>kaptcha<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>  \t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>0.0.9<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n</blockquote>\n<blockquote>\n<p><strong>配置类 CaptchaConfig.java</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.boyolo.server.config;<br><br><span class=\"hljs-keyword\">import</span> com.google.code.kaptcha.impl.DefaultKaptcha;<br><span class=\"hljs-keyword\">import</span> com.google.code.kaptcha.util.Config;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Bean;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Configuration;<br><span class=\"hljs-keyword\">import</span> java.util.Properties;<br><br><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CaptchaConfig</span> </span>&#123;<br><br>  <span class=\"hljs-meta\">@Bean</span><br>  <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> DefaultKaptcha <span class=\"hljs-title\">defaultKaptcha</span><span class=\"hljs-params\">()</span> </span>&#123;<br>    <span class=\"hljs-comment\">//验证码生成器</span><br>    DefaultKaptcha defaultKaptcha = <span class=\"hljs-keyword\">new</span> DefaultKaptcha();<br>    <span class=\"hljs-comment\">//配置</span><br>    Properties properties = <span class=\"hljs-keyword\">new</span> Properties();<br>    <span class=\"hljs-comment\">//是否有边框</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.border&quot;</span>, <span class=\"hljs-string\">&quot;yes&quot;</span>);<br>    <span class=\"hljs-comment\">//设置边框颜色</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.border.color&quot;</span>, <span class=\"hljs-string\">&quot;105,179,90&quot;</span>);<br>    <span class=\"hljs-comment\">//边框粗细度，默认为1</span><br>    <span class=\"hljs-comment\">// properties.setProperty(&quot;kaptcha.border.thickness&quot;,&quot;1&quot;);</span><br>    <span class=\"hljs-comment\">//验证码</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.session.key&quot;</span>, <span class=\"hljs-string\">&quot;code&quot;</span>);<br>    <span class=\"hljs-comment\">//验证码文本字符颜色 默认为黑色</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.textproducer.font.color&quot;</span>, <span class=\"hljs-string\">&quot;blue&quot;</span>);<br>    <span class=\"hljs-comment\">//设置字体样式</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.textproducer.font.names&quot;</span>, <span class=\"hljs-string\">&quot;宋体,楷体,微软雅黑&quot;</span>);<br>    <span class=\"hljs-comment\">//字体大小，默认40</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.textproducer.font.size&quot;</span>, <span class=\"hljs-string\">&quot;30&quot;</span>);<br>    <span class=\"hljs-comment\">//验证码文本字符内容范围 默认为abced2345678gfynmnpwx</span><br>    <span class=\"hljs-comment\">// properties.setProperty(&quot;kaptcha.textproducer.char.string&quot;, &quot;&quot;);</span><br>    <span class=\"hljs-comment\">//字符长度，默认为5</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.textproducer.char.length&quot;</span>, <span class=\"hljs-string\">&quot;4&quot;</span>);<br>    <span class=\"hljs-comment\">//字符间距 默认为2</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.textproducer.char.space&quot;</span>, <span class=\"hljs-string\">&quot;4&quot;</span>);<br>    <span class=\"hljs-comment\">//验证码图片宽度 默认为200</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.image.width&quot;</span>, <span class=\"hljs-string\">&quot;100&quot;</span>);<br>    <span class=\"hljs-comment\">//验证码图片高度 默认为40</span><br>    properties.setProperty(<span class=\"hljs-string\">&quot;kaptcha.image.height&quot;</span>, <span class=\"hljs-string\">&quot;40&quot;</span>);<br>    Config config = <span class=\"hljs-keyword\">new</span> Config(properties);<br>    defaultKaptcha.setConfig(config);<br>    <span class=\"hljs-keyword\">return</span> defaultKaptcha;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n</blockquote>\n<blockquote>\n<p><strong>CaptchaController</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.boyolo.server.controller;<br><span class=\"hljs-keyword\">import</span> com.google.code.kaptcha.impl.DefaultKaptcha;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiOperation;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class=\"hljs-keyword\">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class=\"hljs-keyword\">import</span> javax.imageio.ImageIO;<br><span class=\"hljs-keyword\">import</span> javax.servlet.ServletOutputStream;<br><span class=\"hljs-keyword\">import</span> javax.servlet.http.HttpServletRequest;<br><span class=\"hljs-keyword\">import</span> javax.servlet.http.HttpServletResponse;<br><span class=\"hljs-keyword\">import</span> java.awt.image.BufferedImage;<br><span class=\"hljs-keyword\">import</span> java.io.IOException;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> renbo</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-meta\">@RestController</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CaptchaController</span> </span>&#123;<br><br>  <span class=\"hljs-meta\">@Autowired</span><br>  <span class=\"hljs-keyword\">private</span> DefaultKaptcha defaultKaptcha;<br><br>  <span class=\"hljs-meta\">@ApiOperation(value = &quot;验证码&quot;)</span><br>  <span class=\"hljs-meta\">@GetMapping(value = &quot;/captcha&quot;, produces = &quot;image/jpeg&quot;)</span><br>  <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">captcha</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;<br>    <span class=\"hljs-comment\">// 定义response输出类型为image/jpeg类型</span><br>    response.setDateHeader(<span class=\"hljs-string\">&quot;Expires&quot;</span>, <span class=\"hljs-number\">0</span>);<br>    <span class=\"hljs-comment\">// Set standard HTTP/1.1 no-cache headers.</span><br>    response.setHeader(<span class=\"hljs-string\">&quot;Cache-Control&quot;</span>, <span class=\"hljs-string\">&quot;no-store, no-cache, must-revalidate&quot;</span>);<br>    <span class=\"hljs-comment\">// Set IE extended HTTP/1.1 no-cache headers (use addHeader).</span><br>    response.addHeader(<span class=\"hljs-string\">&quot;Cache-Control&quot;</span>, <span class=\"hljs-string\">&quot;post-check=0, pre-check=0&quot;</span>);<br>    <span class=\"hljs-comment\">// Set standard HTTP/1.0 no-cache header.</span><br>    response.setHeader(<span class=\"hljs-string\">&quot;Pragma&quot;</span>, <span class=\"hljs-string\">&quot;no-cache&quot;</span>);<br>    <span class=\"hljs-comment\">// return a jpeg</span><br>    response.setContentType(<span class=\"hljs-string\">&quot;image/jpeg&quot;</span>);<br>    <span class=\"hljs-comment\">//-------------------生成验证码 begin ------------------------</span><br>    <span class=\"hljs-comment\">//获取验证码文本内容</span><br>    String text = defaultKaptcha.createText();<br>    System.out.println(<span class=\"hljs-string\">&quot;验证码内容：&quot;</span> + text);<br>    <span class=\"hljs-comment\">//将验证码放入session中</span><br>    request.getSession().setAttribute(<span class=\"hljs-string\">&quot;captcha&quot;</span>, text);<br>    <span class=\"hljs-comment\">//根据文本内容创建图形验证码</span><br>    BufferedImage image = defaultKaptcha.createImage(text);<br>    ServletOutputStream outputStream = <span class=\"hljs-keyword\">null</span>;<br>    <span class=\"hljs-keyword\">try</span> &#123;<br>      outputStream = response.getOutputStream();<br>      <span class=\"hljs-comment\">//输出流输出图片，格式jpg</span><br>      ImageIO.write(image, <span class=\"hljs-string\">&quot;jpg&quot;</span>, outputStream);<br>      outputStream.flush();<br>    &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>      e.printStackTrace();<br>    &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>      <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != outputStream) &#123;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>          outputStream.close();<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>          e.printStackTrace();<br>        &#125;<br>      &#125;<br>    &#125;<br>    <span class=\"hljs-comment\">//-------------------生成验证码 end --------------------------</span><br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n</blockquote>\n","categories":[{"name":"Java","path":"api/categories/Java.json"},{"name":"验证码","path":"api/categories/验证码.json"}],"tags":[{"name":"Java,Spring,验证码","path":"api/tags/Java,Spring,验证码.json"}]}