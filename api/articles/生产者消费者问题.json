{"title":"生产者消费者问题","slug":"生产者消费者问题","date":"2021-12-21T14:02:39.000Z","updated":"2021-12-22T07:58:50.554Z","comments":true,"path":"api/articles/生产者消费者问题.json","realPath":null,"excerpt":null,"covers":null,"cover":"/images/theme/coverphoto/生产者消费者问题.jpg","content":"<blockquote>\n<p>The world puts off its mask of vastness to its lover.</p>\n<p>世界对着它的爱人，把它浩翰的面具揭下了。　　</p>\n<p>It becomes small as one song, as one kiss of the eternal.</p>\n<p>它变小了，小如一首歌，小如一回永恒的接吻。　　　　　　　　　　　</p>\n</blockquote>\n<h2 id=\"生产者消费者问题\"><a href=\"#生产者消费者问题\" class=\"headerlink\" title=\"生产者消费者问题\"></a>生产者消费者问题</h2><p>生产者消费者问题（英语：Producer-consumer problem），也称有限缓冲问题（英语：Bounded-buffer problem），是一个多线程同步问题的经典案例。该问题描述了共享固定大小缓冲区的两个线程——即所谓的“生产者”和“消费者”——在实际运行时会发生的问题。生产者的主要作用是生成一定量的数据放到缓冲区中，然后重复此过程。与此同时，消费者也在缓冲区消耗这些数据。该问题的关键就是要保证生产者不会在缓冲区满时加入数据，消费者也不会在缓冲区中空时消耗数据。</p>\n<p>要解决该问题，就必须让生产者在缓冲区满时休眠（要么干脆就放弃数据），等到下次消费者消耗缓冲区中的数据的时候，生产者才能被唤醒，开始往缓冲区添加数据。同样，也可以让消费者在缓冲区空时进入休眠，等到生产者往缓冲区添加数据之后，再唤醒消费者。通常采用进程间通信的方法解决该问题。如果解决方法不够完善，则容易出现死锁的情况。出现死锁时，两个线程都会陷入休眠，等待对方唤醒自己。该问题也能被推广到多个生产者和消费者的情形。</p>\n<p><strong>该问题需要注意的几点：</strong></p>\n<ul>\n<li>在缓冲区为空时，消费者不能再进行消费</li>\n<li>在缓冲区为满时，生产者不能再进行生产</li>\n<li>在一个线程进行生产或消费时，其余线程不能再进行生产或消费等操作，即保持线程间的同步</li>\n<li>注意条件变量与互斥锁的顺序</li>\n</ul>\n<p>由于前两点原因，因此需要保持线程间的同步，即一个线程消费（或生产）完，其他线程才能进行竞争CPU，获得消费（或生产）的机会。对于这一点，可以使用条件变量进行线程间的同步：生产者线程在product之前，需要wait直至获取自己所需的信号量之后，才会进行product的操作；同样，对于消费者线程，在consume之前需要wait直到没有线程在访问共享区（缓冲区），再进行consume的操作，之后再解锁并唤醒其他可用阻塞线程。<br>在访问共享区资源时，为避免多个线程同时访问资源造成混乱，需要对共享资源加锁，从而保证某一时刻只有一个线程在访问共享资源。\u0010\u0010\u0010</p>\n<h3 id=\"管程法\"><a href=\"#管程法\" class=\"headerlink\" title=\"管程法\"></a>管程法</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//测试：生产者消费者模型---&gt;利用缓冲区解决：管程法</span><br><span class=\"hljs-comment\">//生产者，消费者，产品，缓冲区</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">TestPC</span> </span>&#123;<br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> </span>&#123;<br>\t\tSynContainer container = <span class=\"hljs-keyword\">new</span> SynContainer();<br>\t\t<span class=\"hljs-keyword\">new</span> Productor(container).start();<br>\t\t<span class=\"hljs-keyword\">new</span> Consumer(container).start();<br>\t&#125;<br>&#125;<br><br><span class=\"hljs-comment\">//生产者</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Productor</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Thread</span> </span>&#123;<br>\tSynContainer container;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">Productor</span><span class=\"hljs-params\">(SynContainer container)</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">this</span>.container = container;<br>\t&#125;<br><br>\t<span class=\"hljs-comment\">// 生产</span><br>\t<span class=\"hljs-meta\">@Override</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">run</span><span class=\"hljs-params\">()</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">100</span>; i++) &#123;<br>\t\t\tcontainer.push(<span class=\"hljs-keyword\">new</span> Chicken(i));<br>\t\t\tSystem.out.println(<span class=\"hljs-string\">&quot;生产了&quot;</span> + i + <span class=\"hljs-string\">&quot;只鸡&quot;</span>);<br>\t\t&#125;<br>\t&#125;<br>&#125;<br><br><span class=\"hljs-comment\">//消费者</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Consumer</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Thread</span> </span>&#123;<br><br>\tSynContainer container;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">Consumer</span><span class=\"hljs-params\">(SynContainer container)</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">this</span>.container = container;<br>\t&#125;<br><br>\t<span class=\"hljs-comment\">// 消费</span><br>\t<span class=\"hljs-meta\">@Override</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">run</span><span class=\"hljs-params\">()</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">100</span>; i++) &#123;<br>\t\t\tSystem.out.println(<span class=\"hljs-string\">&quot;消费了--&gt;&quot;</span> + container.pop().id + <span class=\"hljs-string\">&quot;只鸡&quot;</span>);<br>\t\t&#125;<br>\t&#125;<br>&#125;<br><br><span class=\"hljs-comment\">//产品</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Chicken</span> </span>&#123;<br>\t<span class=\"hljs-keyword\">int</span> id;<span class=\"hljs-comment\">// 产品编号</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">Chicken</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> id)</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">this</span>.id = id;<br>\t&#125;<br><br>&#125;<br><br><span class=\"hljs-comment\">//缓冲区</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SynContainer</span> </span>&#123;<br><br>\t<span class=\"hljs-comment\">// 需要一个容器大小</span><br>\tChicken[] chickens = <span class=\"hljs-keyword\">new</span> Chicken[<span class=\"hljs-number\">10</span>];<br>\t<span class=\"hljs-comment\">// 容器计数器</span><br>\t<span class=\"hljs-keyword\">int</span> count = <span class=\"hljs-number\">0</span>;<br><br>\t<span class=\"hljs-comment\">// 生产者放入产品</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">synchronized</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">push</span><span class=\"hljs-params\">(Chicken chicken)</span> </span>&#123;<br>\t\t<span class=\"hljs-comment\">// 如果容器满了，就需要等待消费者消费</span><br>\t\t<span class=\"hljs-keyword\">if</span> (count == chickens.length) &#123;<br>\t\t\t<span class=\"hljs-comment\">// 通知消费者消费，生产者等待</span><br>\t\t\t<span class=\"hljs-keyword\">try</span> &#123;<br>\t\t\t\t<span class=\"hljs-keyword\">this</span>.wait();<br>\t\t\t&#125; <span class=\"hljs-keyword\">catch</span> (InterruptedException e) &#123;<br>\t\t\t\t<span class=\"hljs-comment\">// TODO Auto-generated catch block</span><br>\t\t\t\te.printStackTrace();<br>\t\t\t&#125;<br>\t\t&#125;<br>\t\t<span class=\"hljs-comment\">// 如果没有满，我们就放入产品</span><br>\t\tchickens[count] = chicken;<br>\t\tcount++;<br>\t\t<span class=\"hljs-comment\">//通知消费者消费了</span><br>\t\t<span class=\"hljs-keyword\">this</span>.notifyAll();<br>\t&#125;<br><br>\t<span class=\"hljs-comment\">// 消费者消费产品</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">synchronized</span> Chicken <span class=\"hljs-title\">pop</span><span class=\"hljs-params\">()</span> </span>&#123;<br>\t\t<span class=\"hljs-comment\">// 判断是否能消费</span><br>\t\t<span class=\"hljs-keyword\">if</span> (count == <span class=\"hljs-number\">0</span>) &#123;<br>\t\t\t<span class=\"hljs-comment\">// 等待生产者生产，消费者等待</span><br>\t\t\t<span class=\"hljs-keyword\">try</span> &#123;<br>\t\t\t\t<span class=\"hljs-keyword\">this</span>.wait();<br>\t\t\t&#125; <span class=\"hljs-keyword\">catch</span> (InterruptedException e) &#123;<br>\t\t\t\t<span class=\"hljs-comment\">// TODO Auto-generated catch block</span><br>\t\t\t\te.printStackTrace();<br>\t\t\t&#125;<br><br>\t\t&#125; <span class=\"hljs-comment\">// 如果可以消费</span><br>\t\tcount--;<br>\t\tChicken chicken = chickens[count];<br>\t\t<span class=\"hljs-comment\">// 吃完了，通知生产者生产</span><br>\t\t<span class=\"hljs-keyword\">this</span>.notifyAll();<br>\t\t<span class=\"hljs-keyword\">return</span> chicken;<br>\t&#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n<h3 id=\"信号灯法\"><a href=\"#信号灯法\" class=\"headerlink\" title=\"信号灯法\"></a>信号灯法</h3><p>通过标志位解决</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.test.Thread;<br><span class=\"hljs-comment\">//解决生产者消费者问题方法2：信号灯法</span><br><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">TestPC2</span> </span>&#123;<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> </span>&#123;<br>        TV tv =<span class=\"hljs-keyword\">new</span> TV();<br>        <span class=\"hljs-keyword\">new</span> Player(tv).start();<br>        <span class=\"hljs-keyword\">new</span> Watcher(tv).start();<br>    &#125;<br>&#125;<br><span class=\"hljs-comment\">//生产者：演员</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Player</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Thread</span></span>&#123;<br>    TV tv;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">Player</span><span class=\"hljs-params\">(TV tv)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">this</span>.tv = tv;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">run</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">20</span>; i++) &#123;<br>            <span class=\"hljs-keyword\">if</span>(i%<span class=\"hljs-number\">2</span>==<span class=\"hljs-number\">0</span>)&#123;<br>                <span class=\"hljs-keyword\">this</span>.tv.play(<span class=\"hljs-string\">&quot;快乐大本营&quot;</span>);<br>            &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>                <span class=\"hljs-keyword\">this</span>.tv.play(<span class=\"hljs-string\">&quot;斗鱼&quot;</span>);<br>            &#125;<br><br>        &#125;<br>    &#125;<br>&#125;<br><span class=\"hljs-comment\">//消费者：观众</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Watcher</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Thread</span></span>&#123;<br>    TV tv;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">Watcher</span><span class=\"hljs-params\">(TV tv)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">this</span>.tv = tv;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">run</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">20</span>; i++) &#123;<br>            tv.watch();<br><br>        &#125;<br>    &#125;<br>&#125;<br><span class=\"hljs-comment\">//产品：电视节目</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">TV</span></span>&#123;<br>    <span class=\"hljs-comment\">//演员表演，观众等待 T</span><br>    <span class=\"hljs-comment\">//观众观看，演员等待 F</span><br>    String voice;<br>    <span class=\"hljs-keyword\">boolean</span> flag =<span class=\"hljs-keyword\">true</span>;<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">synchronized</span>  <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">play</span><span class=\"hljs-params\">(String voice)</span></span>&#123;<br>        <span class=\"hljs-comment\">//观众观看，演员等待</span><br>        <span class=\"hljs-keyword\">if</span> (!flag)&#123;<br>            <span class=\"hljs-keyword\">try</span> &#123;<br>                <span class=\"hljs-keyword\">this</span>.wait();<br>            &#125; <span class=\"hljs-keyword\">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-comment\">//若观众没看，演员表演</span><br>        System.out.println(<span class=\"hljs-string\">&quot;演员表演了&quot;</span>+voice);<br>        <span class=\"hljs-comment\">//通知观众看</span><br>        <span class=\"hljs-keyword\">this</span>.notifyAll();<br>        <span class=\"hljs-keyword\">this</span>.voice=voice;<br>        <span class=\"hljs-keyword\">this</span>.flag=!<span class=\"hljs-keyword\">this</span>.flag;<br><br>    &#125;<br>    <span class=\"hljs-comment\">//观看方法</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">synchronized</span>  <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">watch</span><span class=\"hljs-params\">()</span></span>&#123;<br>        <span class=\"hljs-comment\">//演员表演观众等待</span><br>        <span class=\"hljs-keyword\">if</span>(flag)&#123;<br>            <span class=\"hljs-keyword\">try</span> &#123;<br>                <span class=\"hljs-keyword\">this</span>.wait();<br>            &#125; <span class=\"hljs-keyword\">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>        System.out.println(<span class=\"hljs-string\">&quot;观看了：&quot;</span>+voice);<br>        <span class=\"hljs-comment\">//通知演员表演</span><br>        <span class=\"hljs-keyword\">this</span>.notifyAll();<br>        <span class=\"hljs-keyword\">this</span>.flag=!<span class=\"hljs-keyword\">this</span>.flag;<br><br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n","more":"<blockquote>\n<p>The world puts off its mask of vastness to its lover.</p>\n<p>世界对着它的爱人，把它浩翰的面具揭下了。　　</p>\n<p>It becomes small as one song, as one kiss of the eternal.</p>\n<p>它变小了，小如一首歌，小如一回永恒的接吻。　　　　　　　　　　　</p>\n</blockquote>\n<h2 id=\"生产者消费者问题\"><a href=\"#生产者消费者问题\" class=\"headerlink\" title=\"生产者消费者问题\"></a>生产者消费者问题</h2><p>生产者消费者问题（英语：Producer-consumer problem），也称有限缓冲问题（英语：Bounded-buffer problem），是一个多线程同步问题的经典案例。该问题描述了共享固定大小缓冲区的两个线程——即所谓的“生产者”和“消费者”——在实际运行时会发生的问题。生产者的主要作用是生成一定量的数据放到缓冲区中，然后重复此过程。与此同时，消费者也在缓冲区消耗这些数据。该问题的关键就是要保证生产者不会在缓冲区满时加入数据，消费者也不会在缓冲区中空时消耗数据。</p>\n<p>要解决该问题，就必须让生产者在缓冲区满时休眠（要么干脆就放弃数据），等到下次消费者消耗缓冲区中的数据的时候，生产者才能被唤醒，开始往缓冲区添加数据。同样，也可以让消费者在缓冲区空时进入休眠，等到生产者往缓冲区添加数据之后，再唤醒消费者。通常采用进程间通信的方法解决该问题。如果解决方法不够完善，则容易出现死锁的情况。出现死锁时，两个线程都会陷入休眠，等待对方唤醒自己。该问题也能被推广到多个生产者和消费者的情形。</p>\n<p><strong>该问题需要注意的几点：</strong></p>\n<ul>\n<li>在缓冲区为空时，消费者不能再进行消费</li>\n<li>在缓冲区为满时，生产者不能再进行生产</li>\n<li>在一个线程进行生产或消费时，其余线程不能再进行生产或消费等操作，即保持线程间的同步</li>\n<li>注意条件变量与互斥锁的顺序</li>\n</ul>\n<p>由于前两点原因，因此需要保持线程间的同步，即一个线程消费（或生产）完，其他线程才能进行竞争CPU，获得消费（或生产）的机会。对于这一点，可以使用条件变量进行线程间的同步：生产者线程在product之前，需要wait直至获取自己所需的信号量之后，才会进行product的操作；同样，对于消费者线程，在consume之前需要wait直到没有线程在访问共享区（缓冲区），再进行consume的操作，之后再解锁并唤醒其他可用阻塞线程。<br>在访问共享区资源时，为避免多个线程同时访问资源造成混乱，需要对共享资源加锁，从而保证某一时刻只有一个线程在访问共享资源。\u0010\u0010\u0010</p>\n<h3 id=\"管程法\"><a href=\"#管程法\" class=\"headerlink\" title=\"管程法\"></a>管程法</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//测试：生产者消费者模型---&gt;利用缓冲区解决：管程法</span><br><span class=\"hljs-comment\">//生产者，消费者，产品，缓冲区</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">TestPC</span> </span>&#123;<br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> </span>&#123;<br>\t\tSynContainer container = <span class=\"hljs-keyword\">new</span> SynContainer();<br>\t\t<span class=\"hljs-keyword\">new</span> Productor(container).start();<br>\t\t<span class=\"hljs-keyword\">new</span> Consumer(container).start();<br>\t&#125;<br>&#125;<br><br><span class=\"hljs-comment\">//生产者</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Productor</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Thread</span> </span>&#123;<br>\tSynContainer container;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">Productor</span><span class=\"hljs-params\">(SynContainer container)</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">this</span>.container = container;<br>\t&#125;<br><br>\t<span class=\"hljs-comment\">// 生产</span><br>\t<span class=\"hljs-meta\">@Override</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">run</span><span class=\"hljs-params\">()</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">100</span>; i++) &#123;<br>\t\t\tcontainer.push(<span class=\"hljs-keyword\">new</span> Chicken(i));<br>\t\t\tSystem.out.println(<span class=\"hljs-string\">&quot;生产了&quot;</span> + i + <span class=\"hljs-string\">&quot;只鸡&quot;</span>);<br>\t\t&#125;<br>\t&#125;<br>&#125;<br><br><span class=\"hljs-comment\">//消费者</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Consumer</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Thread</span> </span>&#123;<br><br>\tSynContainer container;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">Consumer</span><span class=\"hljs-params\">(SynContainer container)</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">this</span>.container = container;<br>\t&#125;<br><br>\t<span class=\"hljs-comment\">// 消费</span><br>\t<span class=\"hljs-meta\">@Override</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">run</span><span class=\"hljs-params\">()</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">100</span>; i++) &#123;<br>\t\t\tSystem.out.println(<span class=\"hljs-string\">&quot;消费了--&gt;&quot;</span> + container.pop().id + <span class=\"hljs-string\">&quot;只鸡&quot;</span>);<br>\t\t&#125;<br>\t&#125;<br>&#125;<br><br><span class=\"hljs-comment\">//产品</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Chicken</span> </span>&#123;<br>\t<span class=\"hljs-keyword\">int</span> id;<span class=\"hljs-comment\">// 产品编号</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">Chicken</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> id)</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">this</span>.id = id;<br>\t&#125;<br><br>&#125;<br><br><span class=\"hljs-comment\">//缓冲区</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SynContainer</span> </span>&#123;<br><br>\t<span class=\"hljs-comment\">// 需要一个容器大小</span><br>\tChicken[] chickens = <span class=\"hljs-keyword\">new</span> Chicken[<span class=\"hljs-number\">10</span>];<br>\t<span class=\"hljs-comment\">// 容器计数器</span><br>\t<span class=\"hljs-keyword\">int</span> count = <span class=\"hljs-number\">0</span>;<br><br>\t<span class=\"hljs-comment\">// 生产者放入产品</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">synchronized</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">push</span><span class=\"hljs-params\">(Chicken chicken)</span> </span>&#123;<br>\t\t<span class=\"hljs-comment\">// 如果容器满了，就需要等待消费者消费</span><br>\t\t<span class=\"hljs-keyword\">if</span> (count == chickens.length) &#123;<br>\t\t\t<span class=\"hljs-comment\">// 通知消费者消费，生产者等待</span><br>\t\t\t<span class=\"hljs-keyword\">try</span> &#123;<br>\t\t\t\t<span class=\"hljs-keyword\">this</span>.wait();<br>\t\t\t&#125; <span class=\"hljs-keyword\">catch</span> (InterruptedException e) &#123;<br>\t\t\t\t<span class=\"hljs-comment\">// TODO Auto-generated catch block</span><br>\t\t\t\te.printStackTrace();<br>\t\t\t&#125;<br>\t\t&#125;<br>\t\t<span class=\"hljs-comment\">// 如果没有满，我们就放入产品</span><br>\t\tchickens[count] = chicken;<br>\t\tcount++;<br>\t\t<span class=\"hljs-comment\">//通知消费者消费了</span><br>\t\t<span class=\"hljs-keyword\">this</span>.notifyAll();<br>\t&#125;<br><br>\t<span class=\"hljs-comment\">// 消费者消费产品</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">synchronized</span> Chicken <span class=\"hljs-title\">pop</span><span class=\"hljs-params\">()</span> </span>&#123;<br>\t\t<span class=\"hljs-comment\">// 判断是否能消费</span><br>\t\t<span class=\"hljs-keyword\">if</span> (count == <span class=\"hljs-number\">0</span>) &#123;<br>\t\t\t<span class=\"hljs-comment\">// 等待生产者生产，消费者等待</span><br>\t\t\t<span class=\"hljs-keyword\">try</span> &#123;<br>\t\t\t\t<span class=\"hljs-keyword\">this</span>.wait();<br>\t\t\t&#125; <span class=\"hljs-keyword\">catch</span> (InterruptedException e) &#123;<br>\t\t\t\t<span class=\"hljs-comment\">// TODO Auto-generated catch block</span><br>\t\t\t\te.printStackTrace();<br>\t\t\t&#125;<br><br>\t\t&#125; <span class=\"hljs-comment\">// 如果可以消费</span><br>\t\tcount--;<br>\t\tChicken chicken = chickens[count];<br>\t\t<span class=\"hljs-comment\">// 吃完了，通知生产者生产</span><br>\t\t<span class=\"hljs-keyword\">this</span>.notifyAll();<br>\t\t<span class=\"hljs-keyword\">return</span> chicken;<br>\t&#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n<h3 id=\"信号灯法\"><a href=\"#信号灯法\" class=\"headerlink\" title=\"信号灯法\"></a>信号灯法</h3><p>通过标志位解决</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.test.Thread;<br><span class=\"hljs-comment\">//解决生产者消费者问题方法2：信号灯法</span><br><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">TestPC2</span> </span>&#123;<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> </span>&#123;<br>        TV tv =<span class=\"hljs-keyword\">new</span> TV();<br>        <span class=\"hljs-keyword\">new</span> Player(tv).start();<br>        <span class=\"hljs-keyword\">new</span> Watcher(tv).start();<br>    &#125;<br>&#125;<br><span class=\"hljs-comment\">//生产者：演员</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Player</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Thread</span></span>&#123;<br>    TV tv;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">Player</span><span class=\"hljs-params\">(TV tv)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">this</span>.tv = tv;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">run</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">20</span>; i++) &#123;<br>            <span class=\"hljs-keyword\">if</span>(i%<span class=\"hljs-number\">2</span>==<span class=\"hljs-number\">0</span>)&#123;<br>                <span class=\"hljs-keyword\">this</span>.tv.play(<span class=\"hljs-string\">&quot;快乐大本营&quot;</span>);<br>            &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>                <span class=\"hljs-keyword\">this</span>.tv.play(<span class=\"hljs-string\">&quot;斗鱼&quot;</span>);<br>            &#125;<br><br>        &#125;<br>    &#125;<br>&#125;<br><span class=\"hljs-comment\">//消费者：观众</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Watcher</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Thread</span></span>&#123;<br>    TV tv;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">Watcher</span><span class=\"hljs-params\">(TV tv)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">this</span>.tv = tv;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">run</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">20</span>; i++) &#123;<br>            tv.watch();<br><br>        &#125;<br>    &#125;<br>&#125;<br><span class=\"hljs-comment\">//产品：电视节目</span><br><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">TV</span></span>&#123;<br>    <span class=\"hljs-comment\">//演员表演，观众等待 T</span><br>    <span class=\"hljs-comment\">//观众观看，演员等待 F</span><br>    String voice;<br>    <span class=\"hljs-keyword\">boolean</span> flag =<span class=\"hljs-keyword\">true</span>;<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">synchronized</span>  <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">play</span><span class=\"hljs-params\">(String voice)</span></span>&#123;<br>        <span class=\"hljs-comment\">//观众观看，演员等待</span><br>        <span class=\"hljs-keyword\">if</span> (!flag)&#123;<br>            <span class=\"hljs-keyword\">try</span> &#123;<br>                <span class=\"hljs-keyword\">this</span>.wait();<br>            &#125; <span class=\"hljs-keyword\">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-comment\">//若观众没看，演员表演</span><br>        System.out.println(<span class=\"hljs-string\">&quot;演员表演了&quot;</span>+voice);<br>        <span class=\"hljs-comment\">//通知观众看</span><br>        <span class=\"hljs-keyword\">this</span>.notifyAll();<br>        <span class=\"hljs-keyword\">this</span>.voice=voice;<br>        <span class=\"hljs-keyword\">this</span>.flag=!<span class=\"hljs-keyword\">this</span>.flag;<br><br>    &#125;<br>    <span class=\"hljs-comment\">//观看方法</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">synchronized</span>  <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">watch</span><span class=\"hljs-params\">()</span></span>&#123;<br>        <span class=\"hljs-comment\">//演员表演观众等待</span><br>        <span class=\"hljs-keyword\">if</span>(flag)&#123;<br>            <span class=\"hljs-keyword\">try</span> &#123;<br>                <span class=\"hljs-keyword\">this</span>.wait();<br>            &#125; <span class=\"hljs-keyword\">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>        System.out.println(<span class=\"hljs-string\">&quot;观看了：&quot;</span>+voice);<br>        <span class=\"hljs-comment\">//通知演员表演</span><br>        <span class=\"hljs-keyword\">this</span>.notifyAll();<br>        <span class=\"hljs-keyword\">this</span>.flag=!<span class=\"hljs-keyword\">this</span>.flag;<br><br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n","categories":[{"name":"Java","path":"api/categories/Java.json"},{"name":"多线程","path":"api/categories/多线程.json"},{"name":"多线程","path":"api/categories/多线程.json"},{"name":"生产者消费者问题","path":"api/categories/生产者消费者问题.json"}],"tags":[{"name":"Java,多线程,操作系统,生产者消费者问题","path":"api/tags/Java,多线程,操作系统,生产者消费者问题.json"}]}